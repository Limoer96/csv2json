"use strict";var os=require("os"),space2="  ",space4=space2+space2,newLine=os.EOL,readline=require("readline"),fs=require("fs");function _lineRenderWithHeader(e,r){var i=[];i.push(space2+"{"+newLine);var t=e.length;return e.forEach(function(e,n){i.push(space4+'"'+r[n]+'": "'+e+'"'+(n===t-1?"":",")+newLine)}),i.push(space2+"}"),i}function _lineRenderWithoutHeader(e){var r=space2+"[",i=e.length;return e.forEach(function(e,n){r+='"'+e+'"'+(n===i-1?"":",")}),r+="]"}function renderLine(e,n,r){var i=[];n||i.push(","+newLine);var t=e.split(",");return r?i.push.apply(i,_lineRenderWithHeader(t,r)):i.push(_lineRenderWithoutHeader(t)),i}function renderLineInline(e,r){var i="",n=e.split(","),t=n.length;return n.forEach(function(e,n){i+=r?'"'+r[n]+'": "'+e+'"'+(n===t-1?"":","):'"'+e+'"'+(n===t-1?"":",")}),i}function csv2json(o,c,u){return void 0===u&&(u={header:!0}),new Promise(function(e,n){if(!fs.existsSync(o))throw new Error(o+" file does not exist.");fs.existsSync(c)&&fs.unlinkSync(c);var r=+new Date,i=fs.createReadStream(o);i.on("end",function(){setTimeout(function(){fs.appendFileSync(c,newLine+"]"),e(Date.now()-r)},0)}),fs.appendFileSync(c,"["+newLine);var s,t=readline.createInterface({input:i}),a=u.header?0:1;t.on("line",function(e){var n=[];0===a?s=e.split(","):n=renderLine(e,1===a,s);for(var r=0,i=n;r<i.length;r++){var t=i[r];fs.appendFileSync(c,t)}a+=1})})}function csv2inlineJson(u,f){return void 0===f&&(f={header:!0}),new Promise(function(e,n){if(!fs.existsSync(u))throw new Error(u+" file does not exist.");var r="",i=fs.createReadStream(u);i.on("end",function(){setTimeout(function(){r+="]",e(JSON.parse(r))},0)});var t,s=readline.createInterface({input:i}),a=f.header,o=a?0:1,c=a?"{}":"[]";r+="[",s.on("line",function(e){0===o?t=e.split(","):(r+=(1===o?"":",")+c[0],r+=renderLineInline(e,t),r+=c[1]),o+=1})})}csv2json.inline=csv2inlineJson,module.exports=csv2json;
