"use strict";var os=require("os"),space2="  ",space4=space2+space2,newLine=os.EOL,readline=require("readline"),fs=require("fs");function _lineRenderWithHeader(e,r){var i=[];i.push(space2+"{"+newLine);var t=e.length;return e.forEach(function(e,n){i.push(space4+'"'+r[n]+'": "'+e+'"'+(n===t-1?"":",")+newLine)}),i.push(space2+"}"),i}function _lineRenderWithoutHeader(e){var r=space2+"[",i=e.length;return e.forEach(function(e,n){r+='"'+e+'"'+(n===i-1?"":",")}),r+="]"}function renderLine(e,n,r){var i=[];n||i.push(","+newLine);var t=e.split(",");return r?i.push.apply(i,_lineRenderWithHeader(t,r)):i.push(_lineRenderWithoutHeader(t)),i}function renderLineInline(e,r){var i="",n=e.split(","),t=n.length;return n.forEach(function(e,n){i+=r?'"'+r[n]+'": "'+e+'"'+(n===t-1?"":","):'"'+e+'"'+(n===t-1?"":",")}),i}function csv2json(a,c,u){return void 0===u&&(u=!0),new Promise(function(e,n){fs.existsSync(a)||n(new Error(a+" file does not exist.")),fs.existsSync(c)&&fs.unlinkSync(c);var r=+new Date,i=fs.createReadStream(a);i.on("end",function(){setTimeout(function(){fs.appendFileSync(c,""+newLine),e(Date.now()-r)},0)});var s,t=readline.createInterface({input:i}),o=u?0:1;t.on("line",function(e){var n=[];0===o?s=e.split(","):n=renderLine(e,1===o,s);for(var r=0,i=n;r<i.length;r++){var t=i[r];fs.appendFileSync(c,t)}o+=1})})}function csv2inlineJson(c,u){return void 0===u&&(u=!0),new Promise(function(e,n){fs.existsSync(c)||n(new Error(c+"file does not exist."));var r="",i=fs.createReadStream(c);i.on("end",function(){setTimeout(function(){r+="]",e(JSON.parse(r))},0)});var t,s=readline.createInterface({input:i}),o=u?0:1,a=u?"{}":"[]";r+="[",s.on("line",function(e){0===o?t=e.split(","):(r+=(1===o?"":",")+a[0],r+=renderLineInline(e,t),r+=a[1]),o+=1})})}csv2json.inline=csv2inlineJson,module.exports=csv2json;
